<tui-drawer *tuiPopup="environmentDrawerService.isDrawerOpen()">
  <header>
    <h2 tuiHeader>
      <div tuiTitle>{{ environmentResource.value()?.name }}</div>
      <div tuiAccessories>
        <button
          appearance="icon"
          iconStart="@tui.x"
          tuiIconButton
          type="button"
          (click)="environmentDrawerService.closeDrawer()"
        >
          Close
        </button>
      </div>
    </h2>

    <div class="public-key__container">
      Public key:
      <code>
        {{ environmentResource.value()?.public_key }}

        <button
          tuiHint="Copy public key"
          tuiHintAppearance="dark"
          tuiHintDirection="right"
          appearance="action-grayscale"
          iconStart="@tui.clipboard"
          size="xs"
          tuiIconButton
          type="button"
          [style.border-radius.%]="100"
          (click)="clipboardService.copyToClipboard(environmentResource.value()?.public_key ?? '')"
        ></button>

      </code>
    </div>
  </header>
  <div>
    <h3>Flags</h3>

    <app-new-flag-form
      [projectId]="environmentResource.value()?.project_id"
      (created)="environmentResource.reload()"
      [disabled]="changesToSave()"
    />

    <div [style.text-align]="'right'">

      @if (changesToSave()) {
        <button
          tuiButton
          iconStart="@tui.x" 
          size="s"
          [appearance]="'outline-destructive'"
          (click)="resetLocalFlags()"
          [style.margin-right.px]="10"
        >
          Cancel changes
        </button>
      }

      <button
        tuiButton
        iconStart="@tui.save" 
        size="s"
        [appearance]="changesToSave() ? 'primary' : 'secondary'"
        [disabled]="!changesToSave()"
        (click)="saveChanges()"
        [loading]="updateFlagsRequestStatus.loading()"
      >
        Save changes
      </button>
    </div>

    <div [style.margin-top.px]="10">
      @for (flag of sortedFlags(); track flag.id) {
        <label tuiCell>
          <div tuiTitle [style.color]="'var(--tui-text-secondary)'">
            {{ flag.name }}
          </div>
          <input
            tuiSwitch
            type="checkbox"
            [ngModel]="flag.enabled"
            (ngModelChange)="toggleLocalFlag(flag.id)"
          />
        </label>
      }
    </div>

  </div>
</tui-drawer>
